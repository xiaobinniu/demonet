import{r as s,j as i,s as M,g as C}from"./index-TAAB46RF.js";import{_ as U,ad as N,s as $,ae as P,af as y,ag as E,ah as B,b as j,U as _,a8 as F,o as H,i as A,u as W,E as g,ai as v,aj as J,m as I,ak as O,al as X,R as Y}from"./useAuthNavi-1jCOrt3A.js";const G=""+new URL("bg-y2MqtP-y.png",import.meta.url).href,K=(c,a)=>r=>{const l=screen.width-r.width,u=screen.height*1/2,[f,d]=s.useState({x:l,y:u}),m=s.useRef(!1),h=s.useRef(null),p=s.useRef(!1),R=s.useRef(0),o=e=>{if(e.stopPropagation(),e.changedTouches.length>1||!m.current)return;const{offsetWidth:n,offsetHeight:x}=e.target;let w=e.changedTouches[0].clientX-1/2*n,T=e.changedTouches[0].clientY-1/2*x;d({x:w,y:T})},k=e=>{var n;e.stopPropagation(),N(!0),(n=h.current.classList)==null||n.add("movebox"),document.onpointermove=null,m.current=!1,b()},b=()=>{const e={leftMin:0,leftMax:l,topMin:2*r.height,topMax:screen.height-2*r.height};d(n=>{let x=n.x,w=n.y;return n.x<e.leftMin?x=e.leftMin:n.x>e.leftMax?x=e.leftMax:n.x>e.leftMin&&n.x<e.leftMax&&(x=n.x-.5*screen.width>=0?e.leftMax:e.leftMin),n.y<e.topMin?w=e.topMin:n.y>e.topMax&&(w=e.topMax),{x,y:w}})},L=e=>{var n;e.stopPropagation(),N(!1),(n=h.current.classList)==null||n.remove("movebox"),m.current=!0,document.ontouchmove=o},q=()=>{clearTimeout(R.current),R.current=window.setTimeout(z,1e3),!p.current&&(p.current=!0,d(e=>({x:S(e)?-.6666666666666666*r.width:screen.width-.3333333333333333*r.width,y:e.y})))},z=()=>{p.current=!1,d(e=>({x:S(e)?0:l,y:e.y}))},S=e=>e.x<1/2*screen.width;return s.useEffect(()=>{const e=document.querySelector(".globalScrollContent"),n=U.throttle(q,100);return e==null||e.addEventListener("scroll",n,!0),()=>{e==null||e.removeEventListener("scroll",n,!0),clearTimeout(R.current)}},[]),i.jsx("div",{style:{position:"fixed",zIndex:"100",top:f.y,left:f.x,cursor:"move",width:"auto",height:"auto"},className:`movebox ${a&&"!right-0 !left-[unset]"} `,ref:h,onTouchStart:L,onTouchEnd:k,children:i.jsx(c,{...r})})};function Q({handleClose:c,current:a=null}){$();const t=s.useRef(null);M?P(t,40,E,y(4*.2),y(4.6*.2)):P(t,80,E,y(4*.2),y(4.6*.2));function r(u){u.stopPropagation(),c&&c()}function l(){a!=null&&j.request(_.fetchRedpacket,{key:a.key},"RainPop").then(u=>{u.code==200&&F.success(C("领取成功")),setTimeout(()=>{c&&c()},200)})}return i.jsxs("div",{className:"fixed top-0 left-0 right-0 bottom-0 z-[999]",onClick:l,children:[i.jsx("canvas",{ref:t,className:"w-full h-full"}),i.jsx("div",{className:"absolute top-[1.4rem] md:top-[0.6rem] right-[0.5rem] md:right-[0.5rem]",onClick:r,children:i.jsx(B,{size:M?30:42,style:{color:"#fff"}})})]})}function D(){const{t:c}=W(),a=s.useRef(-1),[t,r]=s.useState(),[l,u]=s.useState({day:0,hms:""});function f(){j.request(_.getRedpacketInfo,{},"_Acticity").then(o=>{o.code==200&&R(o.data)});function R(o){r(o),clearInterval(a.current),(o==null?void 0:o.info.cur)!=null?(u({day:0,hms:""}),I(Q,{current:o==null?void 0:o.info.cur})):(o==null?void 0:o.info.next)!=null&&(a.current=window.setInterval(()=>{const k=(o==null?void 0:o.info.next.beginTime)-Date.now()||0,b=O.countdown(k,!0);u(b)},1e3))}}s.useEffect(()=>{A.online&&f()},[A.online]);function d(){console.log("onActivityRedpacketReset"),f()}function m(){f(),console.log("onActivityRedpacketStart")}function h(){f(),X("RainPop"),console.log("onActivityRedpacketEnd")}s.useEffect(()=>(g.addEvent(v.onActivityRedpacketReset,d),g.addEvent(v.onActivityRedpacketStart,m),g.addEvent(v.onActivityRedpacketEnd,h),()=>{clearInterval(a.current),g.removeEvent(v.onActivityRedpacketReset,d),g.removeEvent(v.onActivityRedpacketStart,m),g.removeEvent(v.onActivityRedpacketEnd,h)}),[]);function p(){I(Y,{config:t==null?void 0:t.config,cur:t==null?void 0:t.info.cur})}return i.jsx("div",{style:{overflow:"hidden",position:"relative",backgroundImage:`url(${G})`,backgroundSize:"120% 120%",backgroundPosition:"0% 50%",display:`${(t==null?void 0:t.info.cur)==null&&(t==null?void 0:t.info.next)==null,""}`},className:"w-[0.78rem] h-[0.532rem]",onClick:p,children:i.jsxs("div",{className:"w-full h-full relative",children:[i.jsx("img",{src:E,alt:"",className:"w-[0.4rem] absolute left-0 top-[0.02rem]"}),(t==null?void 0:t.info.cur)==null&&(t==null?void 0:t.info.next)==null&&i.jsx("div",{className:"w-[0.452rem] px-[5px] absolute right-0 top-1/2 -translate-y-1/2 text-[0.088rem] text-white font-bold text-center",children:c("领取红包")}),(t==null?void 0:t.info.cur)!=null&&i.jsx("div",{className:"w-[0.452rem] px-[5px] absolute right-0 top-1/2 -translate-y-1/2 text-[0.088rem] text-white font-bold text-center",children:c("领取红包")}),(t==null?void 0:t.info.cur)==null&&(t==null?void 0:t.info.next)!=null&&i.jsxs("div",{className:"w-[0.452rem] absolute right-0 top-1/2 -translate-y-1/2 text-[0.088rem] text-white font-bold text-center",children:[l.day>0&&i.jsxs("div",{className:"w-full flex items-center justify-center mb-[0.02rem]",children:[i.jsx("img",{src:J,alt:"",className:"w-[0.08rem]"}),i.jsxs(i.Fragment,{children:[l.day,c("day")]})]}),i.jsx("div",{children:i.jsx(i.Fragment,{children:l.hms})})]})]})})}const V=K(D,!0);function Z(){return A.online?M?i.jsx(V,{width:y(3.9*.2),height:y(2.66*.2)}):i.jsx("div",{className:"fixed right-0 top-1/2",children:i.jsx(D,{})}):null}const ne=H(Z);export{ne as default};
